<!DOCTYPE html>
<html>
<head>
  <title>실시간 차트</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <canvas id="real-time-chart"></canvas>

  <script>
    var ctx = document.getElementById('real-time-chart').getContext('2d');
    var chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],  // x축 값
        datasets: [
          {
            label: 'Data 1',
            data: [],  // y축 값
            backgroundColor: 'rgba(0, 123, 255, 0.5)',
            borderColor: 'rgba(0, 123, 255, 1)',
            borderWidth: 1
          },
          {
            label: 'Data 2',
            data: [],  // y축 값
            backgroundColor: 'rgba(255, 0, 0, 0.5)',
            borderColor: 'rgba(255, 0, 0, 1)',
            borderWidth: 1
          },
          {
            label: 'Data 3',
            data: [],  // y축 값
            backgroundColor: 'rgba(0, 255, 0, 0.5)',
            borderColor: 'rgba(0, 255, 0, 1)',
            borderWidth: 1
          },
          {
            label: 'Data 4',
            data: [],  // y축 값
            backgroundColor: 'rgba(255, 0, 255, 0.5)',
            borderColor: 'rgba(255, 0, 255, 1)',
            borderWidth: 1
          }
        ]
      },
      options: {
        responsive: true,
        animation: {
          duration: 0  // 애니메이션 비활성화
        },
        scales: {
          x: {
            display: true
          },
          y: {
            display: true
          }
        }
      }
    });

    // 실시간 데이터 업데이트 함수
	function updateRealTimeData() {
	  fetch('/api/data')
		.then(response => response.json())
		.then(data => {
		  // 데이터 업데이트
		  chart.data.labels.push(...data.labels);
		  chart.data.datasets[0].data.push(...data.data1);
		  chart.data.datasets[1].data.push(...data.data2);
		  chart.data.datasets[2].data.push(...data.data3);
		  chart.data.datasets[3].data.push(...data.data4);

		  // 데이터 개수 제한 (최대 10개까지 유지)
		  if (chart.data.labels.length > 10) {
			chart.data.labels.splice(0, chart.data.labels.length - 10);
			chart.data.datasets[0].data.splice(0, chart.data.datasets[0].data.length - 10);
			chart.data.datasets[1].data.splice(0, chart.data.datasets[1].data.length - 10);
			chart.data.datasets[2].data.splice(0, chart.data.datasets[2].data.length - 10);
			chart.data.datasets[3].data.splice(0, chart.data.datasets[3].data.length - 10);
		  }

		  // 차트 업데이트
		  chart.update();
		})
		.catch(error => {
		  console.error('Error:', error);
		});

	  // 주기적으로 데이터 업데이트
	  setTimeout(updateRealTimeData, 1000);  // 1초마다 업데이트 (원하는 주기로 조정 가능)
	}

    // 초기 데이터 업데이트 호출
    updateRealTimeData();
  </script>
</body>
</html>