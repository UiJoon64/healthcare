<!DOCTYPE html>
<html>
<head>
  <title>Real-time Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment/moment.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useEffect, useRef } = React;
    const { Line } = Chart; // 수정된 부분: 'Chart'로 수정

    const moment = window.moment;

    const chartColors = {
      red: "rgb(255, 99, 132)",
      orange: "rgb(255, 159, 64)",
      yellow: "rgb(255, 205, 86)",
      green: "rgb(75, 192, 192)",
      blue: "rgb(54, 162, 235)",
      purple: "rgb(153, 102, 255)",
      grey: "rgb(201, 203, 207)"
    };

    const color = Chart.helpers.color;

    const App = () => {
      const chartRef = useRef(null);

      useEffect(() => {
        const chart = chartRef.current.chartInstance;

        const updateRealtimeData = () => {
          const newData = {
            x: moment(),
            y: Math.random()
          };

          chart.data.datasets[0].data.push(newData);

          // 데이터 개수 제한 (최대 30개까지 유지)
          if (chart.data.datasets[0].data.length > 30) {
            chart.data.datasets[0].data.shift();
          }

          chart.update();

          setTimeout(updateRealtimeData, 3000); // 3초마다 업데이트 (원하는 주기로 조정 가능)
        };

        updateRealtimeData();
      }, []);

      const data = {
        datasets: [
          {
            label: "Dataset 1 (linear interpolation)",
            backgroundColor: color(chartColors.red)
              .alpha(0.5)
              .rgbString(),
            borderColor: chartColors.red,
            fill: false,
            lineTension: 0,
            borderDash: [8, 4],
            data: []
          }
        ]
      };

      const options = {
        elements: {
          line: {
            tension: 0.5
          }
        },
        scales: {
          xAxes: [
            {
              type: "realtime",
              distribution: "linear",
              realtime: {
                onRefresh: function(chart) {
                  if (chart.data.datasets[0].data.length > 0) {
                    chart.data.datasets[0].data.push({
                      x: moment(),
                      y: chart.data.datasets[0].data[
                        chart.data.datasets[0].data.length - 1
                      ].y
                    });
                  } else {
                    chart.data.datasets[0].data.push({
                      x: moment(),
                      y: 0
                    });
                  }
                },
                delay: 3000,
                refresh: 1000, // 1초마다 차트 업데이트
                pause: false // 일시 중지하지 않음
              }
            }
          ],
          yAxes: [
            {
              ticks: {
                beginAtZero: true,
                max: 1
              }
            }
          ]
        }
      };

      return (
        <div className="App">
          <Line ref={chartRef} data={data} options={options} />
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
